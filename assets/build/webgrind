#!/bin/bash

set -e

WEBGRIND_ARCHIVE="1.1.0"
WEBGRIND_FORK="rovangju"
WEBGRIND_ROOT="/var/www"

wget -q https://github.com/${WEBGRIND_FORK}/webgrind/archive/${WEBGRIND_ARCHIVE}.zip
unzip ${WEBGRIND_ARCHIVE}.zip -d ${WEBGRIND_ROOT}
rm ${WEBGRIND_ARCHIVE}.zip

cat <<EOF >/etc/apache2/sites-available/00-webgrind.conf
Alias /webgrind /var/www/webgrind-${WEBGRIND_ARCHIVE}
DirectoryIndex /index.php index.php
ProxyPassMatch ^/webgrind/(.*\.php(/.*)?)\$ fcgi://127.0.0.1:9000/var/www/webgrind-${WEBGRIND_ARCHIVE}/\$1
EOF

a2ensite 00-webgrind
